<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Summary Report</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
        }
        .navbar {
            background: #6a11cb;
            color: white;
        }
        .navbar a {
            color: white;
        }
        .navbar a:hover {
            color: #2575fc;
        }
        .card {
            border: none;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }
        .table thead th {
            background: #6a11cb;
            color: white;
        }
        .table-responsive {
            overflow-x: auto;
            white-space: nowrap;
        }
        th, td {
            min-width: 150px;
            max-width: 200px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        @media print {
            /* Hide unnecessary elements */
            .no-print, .no-print * {
                display: none !important;
            }

            /* Ensure the table fits on one page */
            body {
                margin: 0;
                padding: 0;
                font-size: 12px; /* Smaller font for printing */
            }

            .table-responsive {
                overflow: visible !important;
                width: 100% !important;
            }

            table {
                width: 100% !important;
                table-layout: fixed; /* Ensure consistent column widths */
                border-collapse: collapse !important;
            }

            th, td {
                white-space: normal !important; /* Allow text to wrap */
                overflow: visible !important;
                text-overflow: clip !important;
                min-width: auto !important;
                max-width: none !important;
                border: 1px solid #000 !important;
                padding: 4px !important; /* Reduce padding for more space */
            }

            /* Ensure the table header is visible on each printed page */
            thead {
                display: table-header-group;
            }

            /* Adjust card styles for printing */
            .card {
                box-shadow: none !important;
                border: none !important;
            }

            .card-header {
                background: #6a11cb !important;
                color: white !important;
                padding: 8px !important;
            }

            .card-body {
                padding: 8px !important;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-dark no-print">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">Lab Consumables</a>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('index') }}">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('logout') }}">Logout</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Summary Report -->
    <div class="container mt-4">
        <h2 class="text-center">Summary Report</h2>
        
        <!-- Print Button -->
        <div class="d-flex justify-content-start mb-3 no-print">
            <button class="btn btn-success" onclick="window.print()">Print Report</button>
        </div>
        
        <!-- Report Details -->
        <div class="card">
            <div class="card-header">Report Details</div>
            <div class="card-body">
                <p><strong>Report Date:</strong> {{ datetime.utcnow().strftime('%Y-%m-%d %H:%M:%S') }}</p>
                <p><strong>Generated By:</strong> {{ current_user.username }}</p>
            </div>
        </div>

        <!-- Stock Summary Card -->
        <div class="card mt-4">
            <div class="card-header">Stock Summary</div>
            <div class="card-body">
                <p><strong>Total Stock:</strong> {{ total_stock }}</p>
                <p><strong>Total Used:</strong> {{ total_used }}</p>
                <p><strong>Total Remaining:</strong> {{ total_remaining }}</p>
            </div>
        </div>

        <!-- Detailed Stock Report Card -->
        <div class="card mt-4">
            <div class="card-header">Detailed Stock Report</div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-bordered table-striped">
                        <thead class="table-dark">
                            <tr>
                                <th>Name</th>
                                <th>Reception Date</th>
                                <th>Date of first use</th>
                                <th>From whom Received</th>
                                <th>Quantity Received</th>
                                <th>Quantity Issued</th>
                                <th>Loss/Adjust</th>
                                <th>Quantity in Stock</th>
                                <th>Company Name</th>
                                <th>Expiry Date</th>
                                <th>Date Out of Service</th>
                                <th>Status</th>
                                <th>Last Updated By</th>
                                <th>Last Update Date</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for drug in drugs %}
                            <tr>
                                <td>{{ drug.name }}</td>
                                <td>{{ drug.reception_date.strftime('%Y-%m-%d') }}</td>
                                <td>{{ drug.first_used_date.strftime('%Y-%m-%d') if drug.first_used_date else 'N/A' }}</td>
                                <td>{{ drug.received_from }}</td>
                                <td>{{ drug.total_stock }}</td>
                                <td>{{ drug.used }}</td>
                                <td>{{ drug.losses_adjustment }}</td>
                                <td>{{ drug.remaining }}</td>
                                <td>{{ drug.company_name }}</td>
                                <td>{{ drug.expiry_date.strftime('%Y-%m-%d') if drug.expiry_date else 'N/A' }}</td>
                                <td>{{ drug.date_finished.strftime('%Y-%m-%d') if drug.date_finished else 'N/A' }}</td>
                                <td>
                                    {% if drug.__tablename__ == 'expired_drug' %}
                                        <span class="badge bg-danger">Expired</span>
                                    {% else %}
                                        <span class="badge bg-success">Valid</span>
                                    {% endif %}
                                </td>
                                <td>{{ drug.updates[-1].user.username if drug.updates else 'N/A' }}</td>
                                <td>{{ drug.updates[-1].update_date.strftime('%Y-%m-%d %H:%M:%S') if drug.updates else 'N/A' }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>